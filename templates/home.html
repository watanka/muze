<!-- base.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}제목{% endblock %}</title>
</head>
<body>
    {% if user.is_authenticated %}
        <div class="inbox-icon">
            <a href="{% url 'user_messages:inbox' %}">
                <i class="fas fa-inbox"></i>
                <span id="unread-messages-badge" class="badge" style="display: none;">{{ unread_messages_count }}</span>
            </a>
        </div>
            <script>
                    document.addEventListener("DOMContentLoaded", function(){
                        function updateUnreadMessages(){
                            fetch("{% url 'user_messages:unread_messages_count' %}")
                            .then(response => response.json())
                            .then(data => {
                                const badge = document.getElementById("unread-messages-badge");
                                    badge.textContent = data.unread_messages_count;
                                    badge.style.display = "inline-block";
                            })
                            .catch(error => console.error("Error fetching unread messages"))
                        }

                        setInterval(updateUnreadMessages, 10000);

                        updateUnreadMessages();
            });
            </script>

            
    {% endif %}
        </div>
    <!-- 헤더 포함 -->
    {% block content %}
        {% include 'login.html' %}
        <h2>Popular Songs</h2>
        {% include 'musics/index.html' with song_list=popular_song_list %}
        <!-- <h2>New Released Songs</h2>
        {% include 'musics/index.html' with song_list=new_release_song_list %} -->
    {% endblock %}
</body>
</html>